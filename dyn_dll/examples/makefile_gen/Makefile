makefile_gen: main.c foo_list.c foo_list.h
	gcc -o makefile_gen main.c foo_list.c

foo_list.h: Makefile ../../dyn_dll.h
	rm -f $@
	printf '// Automatically generated by %s.\n' "$^" > $@
	printf '// Generated on %s\n' "$$(date)" >> $@
	printf '#ifndef FOO_LIST_H_\n#define FOO_LIST_H_\n' >> $@
	gcc -E -P -CC -D DYN_DLL_VALUE_TYPE='struct foo' -D DYN_DLL_TYPE_NAME=foo_list ../../dyn_dll.h | perl -0777 -pe's,/[*].*?[*]/,,gs' | grep -v -e '^\s*$$' >> $@
	printf '#endif\n' >> $@
	chmod -w $@

foo_list.c: Makefile foo_list.h ../../dyn_dll.h
	rm -f $@
	printf '// Automatically generated by %s.\n' "$^" > $@
	printf '// Generated on %s\n' "$$(date)" >> $@
	printf '#include "inc.h"\n' >> $@
	gcc -E -P -CC -D DYN_DLL_VALUE_TYPE='struct foo' -D DYN_DLL_TYPE_NAME=foo_list -D DYN_DLL_IMPLEMENTATION ../../dyn_dll.h | perl -0777 -pe's,/[*].*?[*]/,,gs' | grep -v -e '^\s*$$' >> $@
	chmod -w $@
