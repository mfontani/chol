makefile_gen: main.c foo_arr.c foo_arr.h
	gcc -o makefile_gen main.c foo_arr.c

foo_arr.h: Makefile ../../dyn_arr.h
	rm -f $@
	printf '// Automatically generated by %s.\n' "$^" > $@
	printf '// Generated on %s\n' "$$(date)" >> $@
	printf '#ifndef FOO_ARR_H_\n#define FOO_ARR_H_\n' >> $@
	gcc -E -P -CC -D DYN_ARR_VALUE_TYPE='struct foo' -D DYN_ARR_TYPE_NAME=foo_arr ../../dyn_arr.h | perl -0777 -pe's,/[*].*?[*]/,,gs' | grep -v -e '^\s*$$' >> $@
	printf '#endif\n' >> $@
	chmod -w $@

foo_arr.c: Makefile foo_arr.h ../../dyn_arr.h
	rm -f $@
	printf '// Automatically generated by %s.\n' "$^" > $@
	printf '// Generated on %s\n' "$$(date)" >> $@
	printf '#include "inc.h"\n' >> $@
	printf '#include "foo_arr.h"\n' >> $@
	gcc -E -P -CC -D DYN_ARR_VALUE_TYPE='struct foo' -D DYN_ARR_TYPE_NAME=foo_arr -D DYN_ARR_IMPLEMENTATION ../../dyn_arr.h | perl -0777 -pe's,/[*].*?[*]/,,gs' | grep -v -e '^\s*$$' >> $@
	chmod -w $@
